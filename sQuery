DROP DATABASE IF EXISTS `test_platform`;
CREATE DATABASE `test_platform` CHARACTER SET 'utf8' COLLATE 'utf8_general_ci';
USE `test_platform`;


-- USER TABLE
CREATE TABLE `test_platform`.`users` (
`USER_ID` int(0) NOT NULL AUTO_INCREMENT,
`FIRST_NAME` varchar(50) NOT NULL COMMENT 'Hakyky adyny yazmaly',
`SURNAME` varchar(50) NOT NULL COMMENT 'Hakyky FAMILYASY',
`E_MAIL` varchar(50) NULL,
`USER_NAME` varchar(50) NOT NULL COMMENT 'NICKNAME, ulanyjy ady yada lakamy (E: aGO, eric)',
`PASSWORD` varchar(50) NOT NULL COMMENT 'MD5 ENCYPTION',
`BIRTH_DATE` date NULL COMMENT 'DOGLAN SENESI',
`PHONE_NUMBER` varchar(25) NULL COMMENT 'TELEPHONE NUMBER',
`COUNTRY` varchar(50) NULL COMMENT 'YURDY',
`CITY` varchar(255) NULL COMMENT 'ADDRESS ',
`ACTIVE` bit(1) NOT NULL DEFAULT 0 COMMENT '0-MAIL ENTAK TASSYKLANMADY, 1-TASSYKLANDY (VE ACTIVE USER)',
`IMAGE` varchar(255) NULL COMMENT 'IMAGE NAME (AHLI SURATLAR BIZ PATHDA DINE IMAGE NAME UYTGEYAR)',
`GENDER` bit(1) NOT NULL DEFAULT 0 COMMENT '0-NOT SELECTED, 1-MALE, 2-FEMALE',
`JOB` varchar(255) NULL COMMENT 'WEZIPESI',
`BIO` text NULL COMMENT 'ABOUT HIS/HER SELFIES it is optional',
`STATUS` bit(1) NOT NULL DEFAULT 0 COMMENT '0-NOT SELECTED, 1- TEACHER, 2- STUDENT',
`VERIFY_CODE` varchar(100) NULL COMMENT 'MAIL BARLAMAK UICN, MAIL TASSYKLAMAK UCIN GOYULYAN CODE',
`CREATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'CREATED TIME',
`ISADMIN` bit(1) NOT NULL DEFAULT 0 COMMENT '0-GENERAL USER, 1-MODIRATOR, 2- ADMINISTRATOR',
`EMAIL_SUBSCRIBE` bit(1) NOT NULL DEFAULT 1 COMMENT '0-NOTIFLAR UCIN MAIL BARMALY DAL, 1-NOTIFLAR UCIN MAIL BARMALY',
`GMT` VARCHAR(10) NOT NULL COMMENT 'GMT+05:00-5 , GMT+05:30-5.5',
`LANGUAGE` VARCHAR(5) NOT NULL DEFAULT 'EN' COMMENT 'TM-TURKMENCE, RU-RUSSIAN, EN-ENGLISH',
UNIQUE INDEX `EMAIL_UNIQUE`(`E_MAIL`) COMMENT '1 EMAIL 1 GIRISH',
UNIQUE INDEX `USERNAME_UNIQUE`(`USER_NAME`) COMMENT '1 USERNAME BASHGA MENZESH BOLMALY DAL',
UNIQUE INDEX `VERIFY_CODE_UNIQUE`(`VERIFY_CODE`) COMMENT '1 VERIFY_CODE 1 GIRISH',
PRIMARY KEY (`USER_ID`)
);

INSERT INTO `test_platform`.`users`(`FIRST_NAME`, `SURNAME`, `E_MAIL`, `USER_NAME`, `BIRTH_DATE`, `PHONE_NUMBER`, `COUNTRY`, `CITY`, `ACTIVE`, `IMAGE`, `GENDER`, `JOB`, `STATUS`, `ISADMIN`,`PASSWORD`,`VERIFY_CODE`) VALUES ('Agamyrat', 'Chariyev', 'agamyrat.chariyev@gmail.com', '#aGO', '1995-09-14', '(+993) 63 384289', 'Turkmenistan', 'Ashgabat', 1, '', 1, 'System', 0, 2, '202cb962ac59075b964b07152d234b70', UUID());







-- TABLO TESTS
CREATE TABLE `test_platform`.`tests` (
`TEST_ID` int(0) NOT NULL AUTO_INCREMENT,
`TEST_NAME` varchar(200) COMMENT 'TEST ADY',
`DESCRIPTION` text COMMENT 'TEST BARADA MAGLUMAT',
`CREATED_BY` int(0) NOT NULL COMMENT 'TESTY DOREDEN ADAM',
`CREATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
`IS_RANDOM` bit(1) NOT NULL DEFAULT 0 COMMENT '0-SORAGLARYN YERLERINI CALYSHMASYN(NO), 1-YES',
`IS_PUBLIC` bit(1) NOT NULL DEFAULT 0 COMMENT '0-PRIVED, 1-PUBLIC',
`IS_ALLOWED` bit(1) NOT NULL DEFAULT 0 COMMENT '0-NOT ALLOWED, 1-ALLOWED',
`PASSWORD` varchar(50) NULL COMMENT 'MD5 ENCRYPTION',
`TEST_IMAGE` varchar(50) NULL COMMENT 'TEST UCIN SURAT',
`LANGUAGE` varchar(30) NOT NULL COMMENT 'TESTDA ULANYLAN DIL',
`KEYWORDS` text COMMENT 'GÖZLEG MAKSATLY',
CONSTRAINT `USER_CON` FOREIGN KEY (`CREATED_BY`) REFERENCES `test_platform`.`users` (`USER_ID`) ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY (`TEST_ID`)
);

CREATE TABLE `test_platform`.`questions`  (
  `QUESTIONS_ID` int(0) NOT NULL AUTO_INCREMENT,
  `TEST_ID` int(0) NOT NULL COMMENT 'TESTYN IDSY',
  -- `ORDER_` int(0) NULL COMMENT 'SORAGYN YZYGIDERLIGI',
  `QUESTION_DATA` text NULL COMMENT 'TUTUSH DATA',
  `ISRANDOM` bit(1) NOT NULL DEFAULT 0 COMMENT '0- NOT RANDOM\\r\\n1- RANDOM',
  `QUESTION_TYPE` ENUM('single-choice','multi-choice','input','true-false','matching', 'blank') NOT NULL,
  PRIMARY KEY (`QUESTIONS_ID`),
  CONSTRAINT `TEST_CON` FOREIGN KEY (`TEST_ID`) REFERENCES `test_platform`.`tests` (`TEST_ID`) ON DELETE CASCADE ON UPDATE CASCADE
);


-- CREATE TABLE `test_platform`.`test_feedback` (
-- `FEEDBACK_ID` int(0) NOT NULL AUTO_INCREMENT,
-- `TEST_ID` int(0) NOT NULL COMMENT 'TEST IDSY',
-- `USER_ID` int(0) NOT NULL COMMENT 'FEEDBACK YAZAN ADAMYN IDSY',
-- `DESCRIPTION` varchar(255) NULL COMMENT 'TEST BARADA GYSGACA MAGLUMAT',
-- `CREATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'FEEDBACK GALDYRYLAN VAGT',
-- `LIKES` bit(1) NOT NULL DEFAULT 0 COMMENT '0- LIKE BASMADY, 1 - LIKE BASDY',
-- `DISLIKE` bit(1) NOT NULL DEFAULT 0 COMMENT '0- DISLIKE BASMADY, 1 -DISLIKE BASDY',
-- `ACTIVE` bit(1) NOT NULL DEFAULT 1 COMMENT '0 - ULANYSHA GOYBERME, 1- ULANYSHA GOYBER',
-- CONSTRAINT `TEST_ID` FOREIGN KEY (`TEST_ID`) REFERENCES `test_platform`.`tests` (`TEST_ID`) ON DELETE CASCADE,
-- PRIMARY KEY (`FEEDBACK_ID`)
-- );
-- INSERT INTO `test_platform`.`test_feedback`(`TEST_ID`, `USER_ID`, `DESCRIPTION`, `LIKES`, `DISLIKE`,`ACTIVE`) VALUES (1, 1, 'GATY ONAT ', 1, 0, 1),(1, 1, 'HALANMADYM',0, 1, 1),(1, 1, 'ORAN AJAYYP', 1, 0, 1), (1, 1, 'SAMSYK SOZLER YAZYLDY HASAP', 1, 0, 0), (2, 1, 'BOLJAK', 1, 0, 1), (2, 1, 'ONADEY', 1, 0, 1);


-- CREATE VIEW test_feedback_likes AS
-- SELECT
-- tests.TEST_ID,
-- tests.TEST_NAME,
-- tests.DESCRIPTION,
-- tests.CREATED_BY,
-- tests.CATEGORY_ID,
-- tests.CREATE_TIME,
-- tests.IS_RANDOM,
-- tests.IS_PUBLIC,
-- tests.IS_ALLOWED,
-- tests.`PASSWORD`,
-- tests.TEST_IMAGE,
-- tests.`LANGUAGE`,
-- tests.KEYWORDS,
-- SUM(test_feedback.`LIKES`) AS LIKE_COUNT,
-- SUM(test_feedback.DISLIKE) AS DISLIKE_COUNT

-- FROM
-- tests
-- LEFT JOIN test_feedback ON tests.TEST_ID = test_feedback.TEST_ID

-- WHERE
-- test_feedback.ACTIVE = 1
-- GROUP BY
-- tests.TEST_ID,
-- tests.TEST_NAME,
-- tests.DESCRIPTION,
-- tests.CREATED_BY,
-- tests.CATEGORY_ID,
-- tests.CREATE_TIME,
-- tests.IS_RANDOM,
-- tests.IS_PUBLIC,
-- tests.IS_ALLOWED,
-- tests.`PASSWORD`,
-- tests.TEST_IMAGE,
-- tests.`LANGUAGE`,
-- tests.KEYWORDS;


-- CREATE TABLE `test_platform`.`question_type` (
-- `QUESTION_TYPE_ID` int(0) NOT NULL AUTO_INCREMENT COMMENT 'QUESTION TYPE ID',
-- `TYPE_NAME_TM` varchar(50) NOT NULL,
-- `TYPE_NAME_EN` varchar(50) NULL,
-- `TYPE_NAME_RU` varchar(50) NULL,
-- `ORDER_` int(255) NULL,
-- `URL` varchar(100) NULL,
-- `ICON` varchar(255) NULL,
-- PRIMARY KEY (`QUESTION_TYPE_ID`)
-- );

-- INSERT INTO question_type(TYPE_NAME_TM, TYPE_NAME_EN, TYPE_NAME_RU, ORDER_)
-- VALUES ('Ýeke saýlawly soraglar', 'Single choice questions', 'Вопросы с одним выбором', 1),
-- ('Köp saýlawly soraglar', 'Multiple choice questions', 'Вопросы с множественным выбором', 2),
-- ('Ikiden biri', 'One of two', 'Одно из двух', 3),
-- ('Boşlugy doldur', 'Fill the space', 'Заполнить поле', 4);



