CREATE DATABASE `testPlatform` CHARACTER SET 'utf8' COLLATE 'utf8_general_ci';
USE testPlatform;


-- USER TABLE
CREATE TABLE `testplatform`.`USERS`  (
  `USEER_ID` int(0) NOT NULL AUTO_INCREMENT,
  `FIRST_NAME` varchar(50) NOT NULL COMMENT 'ADY',
  `SURNAME` varchar(50) NOT NULL COMMENT 'FAMILYASY',
  `E_MAIL` varchar(50) NULL,
  `USER_NAME` varchar(50) NOT NULL COMMENT 'NICKNAME (E: aGO, eric)',
  `PASSWORD` varchar(50) NOT NULL COMMENT 'MD5 ENCYPTION',
  `BIRTH_DATE` date NULL COMMENT 'DOGLAN GUNI',
  `PHONE_NUMBER` varchar(25) NULL COMMENT 'TELEPHONE NUMBER',
  `COUNTRY` varchar(50) NULL COMMENT 'YURDY',
  `CITY` varchar(255) NULL COMMENT 'ADDRESS ',
  `ACTIVE` smallint(2) NOT NULL DEFAULT 0 COMMENT '0-MAIL ENTAK TASSYKLANMADY, 1-TASSYKLANDY (VE ACTIVE USER)',
  `IMAGE` varchar(255) NULL COMMENT 'IMAGE NAME',
  `GENDER` smallint(2) NOT NULL COMMENT '0-NOT SELECTED, 1-MALE, 2-FEMALE',
  `JOB` varchar(255) NULL COMMENT 'WEZIPESI',
  `BIO` text NULL COMMENT 'ABOUT HIS/HER SELFIES',
  `STATUS` smallint(2) NULL DEFAULT 0 COMMENT '0-NOT SELECTED, 1- TEACHER, 2- STUDENT',
  `VERIFY_CODE` varchar(100) NULL COMMENT 'MAIL VARLAMAK UICN, MAIL TASSYKLAMAK UICN GOYULYAN CODE',
  `CREATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP(0) COMMENT 'CREATED TIME',
  `ISADMIN` smallint(2) NOT NULL COMMENT '0-GENERAL USER, 1-MODIRATOR, 2- ADMINISTRATOR',
  `EMAIL_SUBSCRIBE` smallint(2) NOT NULL COMMENT '0-NOTIFLAR UCIN MAIL BARMALY DAL, 1-NOTIFLAR UCIN MAIL BARMALY',
  PRIMARY KEY (`USEER_ID`)
);
INSERT INTO `testplatform`.`users`(`FIRST_NAME`, `SURNAME`, `E_MAIL`, `USER_NAME`, `BIRTH_DATE`, `PHONE_NUMBER`, `COUNTRY`, `CITY`, `ACTIVE`, `IMAGE`, `GENDER`, `JOB`, `STATUS`, `ISADMIN`) VALUES ('Agamyrat', 'Chariyev', 'agamyrat.chariyev@gmail.com', 'aGO', '1995-09-14', '(+993) 63 384289', 'Turkmenistan', 'Ashgabat', 1, '', 1, 'System', 0, 2);


-- CATEGORY TABLE
CREATE TABLE `testplatform`.`CATEGORY`  (
  `CATEGORY_ID` int(0) NOT NULL AUTO_INCREMENT,
  `CATEGORY_NAME_TM` varchar(50) NOT NULL COMMENT 'KATEGORIYANYN TURKMENCE ADY',
  `CATEGORY_NAME_EN` varchar(50) NOT NULL COMMENT 'KATEGORIYANYN INLISCE ADY',
  `CATEGORY_NAME_RU` varchar(50) NOT NULL COMMENT 'KATEGORIYANYN RUSCA ADY',
  `CREATED_BY` int(11) NOT NULL COMMENT 'KATEGORIYANY UYTGEDEN',
  `LAST_UPDATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP(0) ON UPDATE CURRENT_TIMESTAMP(0) COMMENT 'IN SONKY GEZEK UYTGESHIKLIK GIRIZILEN VAGTY',
  `CREATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP(0) COMMENT 'DOREDILEN VAGTY',
  PRIMARY KEY (`CATEGORY_ID`)
);

INSERT INTO `testplatform`.`category`(`CATEGORY_NAME_TM`, `CATEGORY_NAME_EN`, `CATEGORY_NAME_RU`, `CREATED_BY`) VALUES ('HASAPLAMA YLYMY', 'NUMERICAL SCIENCES', 'ЧИСЛЕННЫЕ НАУКИ', 1);
INSERT INTO `testplatform`.`category`(`CATEGORY_NAME_TM`, `CATEGORY_NAME_EN`, `CATEGORY_NAME_RU`, `CREATED_BY`) VALUES ('KOMPYUTER YLYMY', 'COMP SCIENCES', 'COMP НАУКИ', 1);




-- TABLO VERIFY_BLOCK
CREATE TABLE `testplatform`.`VERIFY_BLOCK`  (
  `VERIFY_BLOCK_ID` int(0) NOT NULL AUTO_INCREMENT,
  `BLOCKED_EMAIL` varchar(25) NOT NULL COMMENT 'MAIL TASSYKLAMAK UCIN UGRADAN MAIL BLOCK EDILSE',
  `CREATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP(0) COMMENT 'DOREDILEN VAGTY',
  PRIMARY KEY (`VERIFY_BLOCK_ID`)
);




-- TABLO TESTS
CREATE TABLE `testplatform`.`TESTS`  (
  `TEST_ID` int(0) NOT NULL AUTO_INCREMENT,
  `TEST_NAME` varchar(200) NOT NULL COMMENT 'TEST ADY',
  `DESCRIPTION` text NOT NULL COMMENT 'TEST BARADA MAGLUMAT',
  `CREATED_BY` int(0) NOT NULL COMMENT 'TESTY DOREDEN ADAM',
  `CATEGORY_ID` int(0) NOT NULL COMMENT 'CATEGORIYA ID SY',
  `CREATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP(0),
  `IS_RANDOM` smallint(2) NOT NULL DEFAULT 0 COMMENT '0-SORAGLARYN YERLERINI CALYSHMASYN(NO), 1-YES',
  `IS_PUBLIC` smallint(2) NOT NULL DEFAULT 0 COMMENT '0-PRIVED, 1-PUBLIC',
  `IS_ALLOWED` smallint(2) NOT NULL DEFAULT 0 COMMENT '0-NOT ALLOWED, 1-ALLOWED',
  `PASSWORD` varchar(50) NULL COMMENT 'MD5 ENCRYPTION',
  `TEST_IMAGE` varchar(0) NULL COMMENT 'TEST UCIN SURAT',
  `LANGUAGE` varchar(30) NOT NULL COMMENT 'TESTDA ULANYLAN DIL',
  `KEYWORDS` varchar(255) NULL COMMENT 'GÖZLEG MAKSATLY',
  PRIMARY KEY (`TEST_ID`)
);

INSERT INTO `testplatform`.`tests`(`TEST_NAME`, `DESCRIPTION`, `CREATED_BY`, `CATEGORY_ID`, `PASSWORD`, `LANGUAGE`) VALUES ('Kompýuter gysga ýollary', 'Kompýuterda ulanylýan gysga ýollar.', 1, 2, '202cb962ac59075b964b07152d234b70', 'TURKMEN');
INSERT INTO `testplatform`.`tests`(`TEST_NAME`, `DESCRIPTION`, `CREATED_BY`, `CATEGORY_ID`, `PASSWORD`, `LANGUAGE`) VALUES ('Kompýuter içki gurluşy', 'Kompýuterda içgi gurluşy barada maglumatlar.', 1, 2, '202cb962ac59075b964b07152d234b70', 'TURKMEN');





CREATE TABLE `testplatform`.`TEST_FEEDBACK`  (
  `FEEDBACK_ID` int(0) NOT NULL AUTO_INCREMENT,
  `TEST_ID` int(0) NULL COMMENT 'TEST IDSY',
  `USER_ID` int(0) NULL COMMENT 'FEEDBACK YAZAN ADAMYN IDSY',
  `DESCRIPTION` varchar(255) NULL COMMENT 'TEST BARADA GYSGACA MAGLUMAT',
  `CREATE_TIME` timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP(0) COMMENT 'FEEDBACK GALDYRYLAN VAGT',
  `LIKES` smallint(2) NOT NULL DEFAULT 0 COMMENT '0- LIKE BASMADY, 1 - LIKE BASDY',
  `DISLIKE` smallint(2) NOT NULL DEFAULT 0 COMMENT '0- DISLIKE BASMADY, 1 -DISLIKE BASDY',
  `ACTIVE` smallint(2) NOT NULL DEFAULT 1 COMMENT '0 - ULANYSHA GOYBERME, 1- ULANYSHA GOYBER',
  PRIMARY KEY (`FEEDBACK_ID`)
);
INSERT INTO `testplatform`.`test_feedback`(`TEST_ID`, `USER_ID`, `DESCRIPTION`, `LIKES`, `DISLIKE`,`ACTIVE`) VALUES (1, 1, 'GATY ONAT ', 1, 0, 1),(1, 1, 'HALANMADYM',0, 1, 1),(1, 1, 'ORAN AJAYYP', 1, 0, 1), (1, 1, 'SAMSYK SOZLER YAZYLDY HASAP', 1, 0, 0), (2, 1, 'BOLJAK', 1, 0, 1), (2, 1, 'ONADEY', 1, 0, 1);


CREATE VIEW test_feedback_likes AS
SELECT
	tests.TEST_ID,
	tests.TEST_NAME,
	tests.DESCRIPTION,
	tests.CREATED_BY,
	tests.CATEGORY_ID,
	tests.CREATE_TIME,
	tests.IS_RANDOM,
	tests.IS_PUBLIC,
	tests.IS_ALLOWED,
	tests.`PASSWORD`,
	tests.TEST_IMAGE,
	tests.`LANGUAGE`,
	tests.KEYWORDS,
	SUM(test_feedback.`LIKES`) AS LIKE_COUNT,
	SUM(test_feedback.DISLIKE) AS DISLIKE_COUNT
	
FROM
	test_feedback
	INNER JOIN tests ON tests.TEST_ID = test_feedback.TEST_ID 
WHERE
	test_feedback.ACTIVE = 1 
GROUP BY
	tests.TEST_ID,
	tests.TEST_NAME,
	tests.DESCRIPTION,
	tests.CREATED_BY,
	tests.CATEGORY_ID,
	tests.CREATE_TIME,
	tests.IS_RANDOM,
	tests.IS_PUBLIC,
	tests.IS_ALLOWED,
	tests.`PASSWORD`,
	tests.TEST_IMAGE,
	tests.`LANGUAGE`,
	tests.KEYWORDS;
